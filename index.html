<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">

        <title>Change of life</title>

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="stylesheet" href="css/reveal.css">
        <link rel="stylesheet" href="css/theme/black.css" id="theme">
        <link rel="stylesheet" href="css/styles.css">
        <link rel="stylesheet" href="css/jquery-ui.css">
        <link href='http://fonts.googleapis.com/css?family=Oswald:400,700,300' rel='stylesheet' type='text/css'>
        <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.js"></script>
        <script src="js/Highcharts.js"></script>
        <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
    </head>

    <body>

        <div class="reveal">

            <div class="slides">
                
                <!-- Recorrido en bus -->
                <section data-background-iframe="intro.html">
                    <h2>De Punta a Punta</h2>
                    <p>En Uruguay casi diez mil personas estan privadas de libertad. Un 70% de ellas tienen entre 18 y 35 años.</p>
                    <p>La unidad número 6 Punta de Rieles forma parte del Instituto Nacional de Rehabilitación creado por ley en el 2010.</p>
                </section>
                
                <!-- Estado abierto: cola de personas -->
                <section data-background-iframe="fila.html">
                    
                </section>
                
                <!-- Identificacion -->
               <section data-background="img/IDENTIFICACION-01.jpg">
                   <audio autoplay src="audio/ambiente.mp3" hidden></audio>
                   <div class="formulario" onsubmit="return false">
                       <form action="/">
                           <p class="form">Edad</p>
                           <input type="text" name="edad">
                           <p class="form">Ciudad - Barrio</p>
                           <input type="text" name="barrio">
                           <p class="form">Nivel educativo</p>
                           <input type="text" name="educacion"> </br></br>
                           <button onclick="Reveal.next()">Ingresar</button>
                       </form>
                   </div>
               </section>
                
                <!-- Susto y transicion -->
                <section data-background-iframe="susto.html">
                    
                </section>
               
                <!-- Pregunta 1 -->
                <section data-background="img/Background-02.jpg" >
                    <p class="pregunta">¿Qué % de reincidentes crees que tiene la unidad</p>
                    <p class="pregunta">de rehabilitación de Punta de Rieles?</p>
                    
                    <div id="chart-area-pregunta1"></div>
                    <div id="sliders"></div>
                </section>
                
                <!-- Respuesta 1 -->
                <section data-background-transition="slide" data-transition="zoom" data-background="img/Background-02.jpg" >
                    <p class="pregunta"><strong class="plus">5%</strong>&nbsp;&nbsp; frente al &nbsp;&nbsp;<strong>40%</strong>&nbsp;&nbsp; de otras cárceles del país</p>
                    <p style="font-size:0.8em!important">(El usuario promedio responde 62%)</p>
                </section>

                <!-- Clip 1 -->
                <section data-background-iframe="pregunta1.html">
                </section>
                
                <!-- Test -->
                <!--section  data-transition="concave" data-background="img/Background-bus-partida.jpg">
                    
                </section-->
                
            </div>

        </div>

        <script>
            var INTRO = 1;
            var FILA = 2;
            var SUSTO = 3;
            var STAT_PREGUNTA1 = 4;
            var PREGUNTA1 = 6;
            var FILA_IFRAME_INDEX = 1;
            var SUSTO_IFRAME_INDEX = 2;
            var PREGUNTA1_IFRAME_INDEX = 3;
            
            Reveal.initialize({
                transition: 'linear',
                autoSlide: 0,
                overview: false,
                controls: false
            });

            $(function () {
                //var ctx = document.getElementById("chart-area").getContext("2d");
                //window.myPie = new Chart(ctx).Pie(pieData);
                $( "#introTitle").fadeOut("200000", function() {
                    // Animation complete.
                });
                loadPiePregunta1();
            });
            
            var chart = null;
            
            function loadPiePregunta1() {
                // Build the chart
                chart = new Highcharts.Chart({
                    chart: {
                        renderTo: 'chart-area-pregunta1',
                        plotBackgroundColor: null,
                        plotBorderWidth: null,
                        plotShadow: false,
                        backgroundColor: "transparent",
                        borderColor: "transparent",
                        events: {
                            redraw: function () {
                                //update sliders   
                                $.each(chart.series[0].points, function (i, point) {                         
                                    point.slider.slider('value', point.percentage);   
                                });
                            }
                        }
                    },
                    title: {
                        text: ''
                    },
                    tooltip: {
                        pointFormat: '{series.name}: <b>{point.percentage}%</b>',
                        percentageDecimals: 1
                    },
                    plotOptions: {
                        pie: {
                            allowPointSelect: true,
                            cursor: 'pointer',
                            dataLabels: {
                                enabled: false
                            },
                            showInLegend: true
                        }
                    },
                    series: [{
                        type: 'pie',
                        name: 'Reincidentes',
                        data: [
                            ['Rehabilitados', 40],
                            ['Reincidentes', 60]
                        ]
                    }]
                });
                var pointsLength = chart.series[0].data.length;
                $.each(chart.series[0].points, function (i, point) {
                    var h = i == 0 ? '<input type="hidden" name="slider[]">' : '<input type="hidden" style="display:none" name="slider[]">';
                    $(h).val(point.y).appendTo('#sliders')
                    point.slider = $('<div></div>').appendTo('#sliders').slider({
                        value: point.y,
                        max: 100,
                        min: 0,
                        slide: function (event, ui) {
                            var prevVal = point.y,
                                step = (ui.value - point.y) / (pointsLength - 1),
                                data = [],
                                newVal;

                            $.each(chart.series[0].points, function(i, p){
                                if (p === point) {
                                    data.push({
                                        name: p.name,
                                        y: ui.value
                                    })
                                } else {
                                    data.push({
                                        name: p.name,
                                        y: p.y - step
                                    })
                                }
                            });
                            chart.series[0].setData(data);
                            $(this).prev().val(ui.value)
                        }
                    })
                    point.slider.children('a').css('background', point.color).text('    ' + point.legendItem.textStr)
                });
        }
                        
        function getUrlVar(param, defaultValue) {
            var vars = [], hash;
            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for(var i = 0; i < hashes.length; i++)    {
               hash = hashes[i].split('=');
               vars.push(hash[0]);
               vars[hash[0]] = hash[1];
            }
            return vars[param] ? vars[param] : defaultValue;
        }

        Reveal.addEventListener( 'slidechanged', function( event ) {
            // event.previousSlide, event.currentSlide, event.indexh, event.indexv
            console.log(event);
                switch (event.indexh) {
                    case INTRO:
                        return finIntro(event);
                        break; 
                    case PREGUNTA1:
                        document.getElementsByTagName("iframe")[PREGUNTA1_IFRAME_INDEX].contentWindow.playVideo();
                        break;
                    case SUSTO:
                        document.getElementsByTagName("iframe")[SUSTO_IFRAME_INDEX].contentWindow.playVideo();
                        break;
                    case STAT_PREGUNTA1:
                        $('#chart-area-pregunta1').highcharts().setSize(900, 400, false);
                        break;
                    
                }
                return event;
        } );

        function estaAbierto() {
            return getUrlVar('estado', 'abierto') == "abierto";
        }

        function finIntro(event) {
            if (!estaAbierto()) {
                window.location = '/changeoflife/cerrado.html';
            } else {
                //Autoplay del video de la fila
                document.getElementsByTagName("iframe")[FILA_IFRAME_INDEX].contentWindow.playVideo();
                if (event) {
                    return event;
                } else {
                    Reveal.next();
                }
            }
        }
        
        function finSusto() {
            Reveal.next();
        }

        function finColaPersonas() {
            document.getElementsByTagName("iframe")[SUSTO_IFRAME_INDEX].contentWindow.playVideo();
            Reveal.next();
            
        }

        function finPregunta1() {
            Reveal.next();
        }

        </script>

    </body>
</html>
