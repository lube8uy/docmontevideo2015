<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">

        <title>Change of life</title>

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="stylesheet" href="css/reveal.css">
        <link rel="stylesheet" href="css/theme/black.css" id="theme">
        <link rel="stylesheet" href="css/styles.css">
        <link rel="stylesheet" href="css/jquery-ui.css">
        <!--link href='http://fonts.googleapis.com/css?family=Oswald:400,700,300' rel='stylesheet' type='text/css'-->
        <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.js"></script>
        <script src="js/Highcharts.js"></script>
        <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
    </head>

    <body>

        <div class="reveal">

            <div class="slides">
                
                <!-- Recorrido en bus 1 -->
                <section data-background-iframe="intro.html" id="INTRO">
                    <h2 id="introTitulo" style="display:none">De Punta a Punta</h2>
                    <p id="introP1" style="display:none">En Uruguay casi diez mil personas estan privadas de libertad. Un 70% de ellas tienen entre 18 y 35 años.</p>
                    <p id="introP2" style="display:none">La unidad número 6 Punta de Rieles forma parte del Instituto Nacional de Rehabilitación creado por ley en el 2010.</p>
                </section>
                
                <!-- Estado abierto: cola de personas 2 -->
                <section data-background-iframe="fila.html" id="FILA">
                    
                </section>
                
                <!-- Identificacion 3 -->
               <section data-background="img/IDENTIFICACION-01.jpg" data-autoslide="0" id="IDENTIFICACION">
                   <audio autoplay src="audio/ambiente.mp3" hidden></audio>
                   <div class="formulario" onsubmit="return false">
                       <form action="/">
                           <p class="form">Edad</p>
                           <input type="text" name="edad">
                           <p class="form">Ciudad - Barrio</p>
                           <input type="text" name="barrio">
                           <p class="form">Nivel educativo</p>
                           <input type="text" name="educacion"> </br></br>
                           <button onclick="Reveal.next()">Ingresar</button>
                       </form>
                   </div>
               </section>
                
                <!-- Susto y transicion 4 -->
                <section data-background-iframe="susto.html" id="SUSTO">
                    
                </section>
                
                <!-- Adentro 5 -->
                <section data-background-iframe="adentro.html" id="ADENTRO">
                    
                </section>
               
                <!-- Pregunta 1 6 -->
                <section data-background="img/Background-02.jpg" data-autoslide="0" id="PREGUNTA1">
                    <p class="pregunta">¿Qué % de reincidentes crees que tiene la unidad</p>
                    <p class="pregunta">de rehabilitación de Punta de Rieles?</p>
                    
                    <div id="chart-area-pregunta1"></div>
                    <div id="sliders"></div>
                </section>
                
                <!-- Respuesta 1 7 -->
                <section data-background-transition="slide" data-transition="zoom" data-background="img/Background-02.jpg"  data-autoslide="0" id="PREGUNTA1_RESPUESTA">
                    <p class="pregunta"><strong class="plus">5%</strong>&nbsp;&nbsp; frente al &nbsp;&nbsp;<strong>40%</strong>&nbsp;&nbsp; de otras cárceles del país</p>
                    <p style="font-size:0.8em!important">(El usuario promedio responde 62%)</p>
                </section>

                <!-- Clip 1 8 -->
                <section data-background-iframe="pregunta1.html" id="PREGUNTA1_CLIP">
                </section>
                
                <!-- Observatorio 9 -->
                <section data-background-iframe="fin_observatorio.html" id="FIN_CLIP">
                </section>

                <!-- Bus y shares 10 -->
                <section data-background-iframe="fin_bus.html" id="FIN_BUS">
                </section>
                    
                </section-->
                
            </div>

        </div>

    <script>
        var INTRO = 0;
        var FILA = 1;
        var IDENTIFICACION = 2;
        var SUSTO = 3;
        var ADENTRO = 4;
        var PREGUNTA1 = 5;
        var PREGUNTA1_RESPUESTA = 6;
        var PREGUNTA1_CLIP = 7;
        var FIN_CLIP = 8;
        var FIN_BUS = 9;

        var INTRO_IFRAME_INDEX = 0;
        var FILA_IFRAME_INDEX = 1;
        var SUSTO_IFRAME_INDEX = 2;
        var ADENTRO_IFRAME_INDEX = 3;
        var PREGUNTA1_CLIP_IFRAME_INDEX = 4;
        var FIN_CLIP_IFRAME_INDEX = 5;
        var FIN_BUS_IFRAME_INDEX = 6;

        Reveal.initialize({
            transition: 'linear',
            autoSlide: 0,
            overview: false,
            controls: false
        });

        $(function () {
            loadPiePregunta1();
        });

        var chart = null;

        function loadPiePregunta1() {
            // Build the chart
            chart = new Highcharts.Chart({
                chart: {
                    renderTo: 'chart-area-pregunta1',
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false,
                    backgroundColor: "transparent",
                    borderColor: "transparent",
                    events: {
                        redraw: function () {
                            //update sliders   
                            $.each(chart.series[0].points, function (i, point) {                         
                                point.slider.slider('value', point.percentage);   
                            });
                        }
                    }
                },
                title: {
                    text: ''
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage}%</b>',
                    percentageDecimals: 1
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: true,
                            format: '<b style="font-size: 2em;">{point.name}</b><span style="font-size: 2em;">: {point.percentage:.1f} %</span>',
                            style: {
                                color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black',
                            }
                        },
                        showInLegend: true
                    }
                },
                series: [{
                    type: 'pie',
                    name: 'Reincidentes',
                    data: [
                        {name: 'Rehabilitados', y: 40},
                        {name: 'Reincidentes', y: 60}
                    ]
                }]
            });
            var pointsLength = chart.series[0].data.length;
            $.each(chart.series[0].points, function (i, point) {
                var h = i == 0 ? '<input type="hidden" name="slider[]">' : '<input type="hidden" style="display:none" name="slider[]">';
                $(h).val(point.y).appendTo('#sliders')
                point.slider = $('<div></div>').appendTo('#sliders').slider({
                    value: point.y,
                    max: 100,
                    min: 0,
                    slide: function (event, ui) {
                        var prevVal = point.y,
                            step = (ui.value - point.y) / (pointsLength - 1),
                            data = [],
                            newVal;

                        $.each(chart.series[0].points, function(i, p){
                            if (p === point) {
                                data.push({
                                    name: p.name,
                                    y: ui.value
                                })
                            } else {
                                data.push({
                                    name: p.name,
                                    y: p.y - step
                                })
                            }
                        });
                        chart.series[0].setData(data);
                        $(this).prev().val(ui.value)
                    }
                })
                point.slider.children('a').css('background', point.color).text('    ' + point.legendItem.textStr)
            });
    }
                        
        function getUrlVar(param, defaultValue) {
            var vars = [], hash;
            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for(var i = 0; i < hashes.length; i++)    {
               hash = hashes[i].split('=');
               vars.push(hash[0]);
               vars[hash[0]] = hash[1];
            }
            return vars[param] ? vars[param] : defaultValue;
        }
        
        Reveal.addEventListener( 'ready', function( event ) {
            // event.currentSlide, event.indexh, event.indexv
            $("#introTitulo").delay(1500).fadeIn(3000, function(){
                $("#introP1").fadeIn(3000).delay(2000).fadeOut(3000, function(){
                    $("#introP2").fadeIn(3000).delay(2000).fadeOut(3000);
                });
            });
            
        } );

        Reveal.addEventListener( 'slidechanged', function( event ) {
            // event.previousSlide, event.currentSlide, event.indexh, event.indexv
            //console.log(event);
            
            switch (event.indexh) {
                case FILA:
                    pausarTodos();
                    document.getElementsByTagName("iframe")[FILA_IFRAME_INDEX].contentWindow.playVideo();
                    //return finIntro(event);
                    break; 
                case SUSTO:
                    pausarTodos();
                    document.getElementsByTagName("iframe")[SUSTO_IFRAME_INDEX].contentWindow.playVideo();
                    break;
                case ADENTRO:
                    pausarTodos();
                    document.getElementsByTagName("iframe")[ADENTRO_IFRAME_INDEX].contentWindow.playVideo();
                    break;    
                case PREGUNTA1_CLIP:
                    pausarTodos();
                    document.getElementsByTagName("iframe")[PREGUNTA1_CLIP_IFRAME_INDEX].contentWindow.playVideo();
                    break;
                case PREGUNTA1:
                    pausarTodos();
                    $('#chart-area-pregunta1').highcharts().setSize(900, 400, false);
                    break;
                case FIN_CLIP:
                    pausarTodos();
                    document.getElementsByTagName("iframe")[FIN_CLIP_IFRAME_INDEX].contentWindow.playVideo();
                    break;
                case FIN_BUS:
                    pausarTodos();
                    document.getElementsByTagName("iframe")[FIN_BUS_IFRAME_INDEX].contentWindow.playVideo();
                    break;    
                default:
                    pausarTodos();
                    break;

            }
            return event;
        } );

        function estaAbierto() {
            return getUrlVar('estado', 'abierto') == "abierto";
        }

        function finIntro(event) {
            if (isCurrentSlide("INTRO")) {
                Reveal.next();
            }
        }
        
        function finSusto() {
            if (isCurrentSlide("SUSTO")) {
                Reveal.next();
            }
        }
        
        function finAdentro() {
            if (isCurrentSlide("ADENTRO")) {
                Reveal.next();
            }
        }

        function finColaPersonas() {
            if (isCurrentSlide("FILA")) {
                Reveal.next();
            }
        }

        function finPregunta1() {
            if (isCurrentSlide("PREGUNTA1_CLIP")) {
                Reveal.next();
            }
        }
        
        function finObservatorio() {
            if (isCurrentSlide("FIN_CLIP")) {
                Reveal.next();
            }
        }
        
        function finBus() {
            if (isCurrentSlide("FIN_BUS")) {
                Reveal.next();
            }
        }
        
        function isCurrentSlide(ID) {
            return $(Reveal.getCurrentSlide()).attr('id') == ID;
        }
        
        function pausarTodos() {
            var iframes = document.getElementsByTagName("iframe");
            //console.log(iframes);
            for (var ifr in iframes) {
                if (ifr.contentWindow && typeof ifr.contentWindow != "undefined" && 
                        typeof ifr.contentWindow.pauseVideo == "function") {
                    ifr.contentWindow.pauseVideo();
                }
            }
        }

        </script>

    </body>
</html>
